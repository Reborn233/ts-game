!function(t){function e(e){for(var r,n,l=e[0],h=e[1],c=e[2],u=0,f=[];u<l.length;u++)n=l[u],i[n]&&f.push(i[n][0]),i[n]=0;for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(t[r]=h[r]);for(a&&a(e);f.length;)f.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],r=!0,l=1;l<s.length;l++){var h=s[l];0!==i[h]&&(r=!1)}r&&(o.splice(e--,1),t=n(n.s=s[0]))}return t}var r={},i={0:0},o=[];function n(e){if(r[e])return r[e].exports;var s=r[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=r,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(s,r,function(e){return t[e]}.bind(null,r));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var l=window.webpackJsonp=window.webpackJsonp||[],h=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var a=h;o.push([0,10]),s()}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),s(1).default.run()},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=s(2),i=10,o=document.documentElement.clientWidth,n=o>500?500:o,l=n,h=(n-5*i)/4,c={LEFT:37,RIGHT:39,UP:38,DOWN:40},a={2:"rgb(236,228,219)",4:"rgb(234,224,203)",8:"rgb(233,179,129)",16:"rgb(232,153,108)",32:"rgb(230,130,103)",64:"rgb(229,103,71)",128:"rgb(232,206,126)",256:"rgb(232,204,114)",512:"rgb(232,199,106)",1024:"rgb(231,198,89)",2048:"rgb(291,188,63)"},u={1:{size:90,space:30},2:{size:75,space:26},3:{size:55,space:20},4:{size:40,space:15}},f=document.createElement("canvas");f.width=l,f.height=l;const d=f.getContext("2d"),b=document.getElementById("app"),p=document.createElement("button");p.textContent="重置",b.appendChild(p),b.appendChild(f);const g=new r(f);g.get("swipe").set({direction:r.DIRECTION_ALL});const k=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,w=(t,e,s,r,i)=>{const o=Math.PI;d.beginPath(),d.arc(t+i,e+i,i,-o,-o/2),d.arc(t+s-i,e+i,i,-o/2,0),d.arc(t+s-i,e+r-i,i,0,o/2),d.arc(t+i,e+r-i,i,o/2,o),d.fill(),d.closePath()},v=t=>{let e,s,r;const i=t.length;for(e=0;e<i;e+=1){for(s=-1,r=e+1;r<i;r++)if(0!==t[r]){s=r;break}-1!==s&&(0===t[e]?(t[e]=t[s],t[s]=0,e-=1):t[e]===t[s]&&(t[e]=2*t[e],t[s]=0))}return t},m=t=>{const e=[],s=t.length;for(let r=0;r<s;r++)for(let i=0;i<s;i++){const o=s-1-i;e[o]||(e[o]=[]),e[o][r]=t[r][i]}return e},y=t=>{const e=[],s=t.length;for(let r=0;r<s;r++)for(let i=0;i<s;i++){const o=s-1-r;e[i]||(e[i]=[]),e[i][o]=t[r][i]}return e};class O{constructor(){this.x=0,this.y=0,this.width=f.width,this.height=f.height,this.color="rgb(185,173,162)",this.brown="rgb(202,192,180)",this.coord=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}render(){this.renderRadius(),d.fillStyle=this.brown;for(let t=0;t<this.coord.length;t++)for(let e=0;e<this.coord[t].length;e++)w(i*(t+1)+h*t,i*(e+1)+h*e,h,h,10)}renderRadius(){const{x:t,y:e,width:s,height:r,color:i="white"}=this;d.fillStyle=i,w(t,e,s,r,10)}}class x{constructor(){this.row=4,this.col=4,this.blocks=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.fontSize=90,this.init()}update(t){}init(){for(let t=0;t<this.row;t++){this.blocks[t]=[];for(let e=0;e<this.col;e++)this.blocks[t][e]=0}this.addBlock(),this.addBlock()}move(t){switch(t){case c.LEFT:this.left();break;case c.RIGHT:this.right();break;case c.UP:this.up();break;case c.DOWN:this.down()}this.addBlock()}up(){const t=[];for(let e=0;e<this.row;e++)t.push(v(m(this.blocks)[e]));this.blocks=y(t)}down(){const t=[];for(let e=0;e<this.row;e++)t.push(v(y(this.blocks)[e]));this.blocks=m(t)}left(){const t=[];for(let e=0;e<this.row;e++)t.push(v(this.blocks[e]));this.blocks=t}right(){const t=[];for(let e=0;e<this.row;e++)t.push(v(this.blocks[e].reverse()).reverse());this.blocks=t}over(){for(let t=0;t<this.row;t++)for(let e=0;e<this.col;e++)if(0===this.blocks[t][e])return!1;return!0}gameOver(){for(let t=0;t<this.row;t++)for(let e=0;e<this.col;e++){if(0===this.blocks[t][e])return!1;if(e<this.blocks[t].length-1&&this.blocks[t][e]===this.blocks[t][e+1])return!1;if(t<this.blocks.length-1&&this.blocks[t][e]===this.blocks[t+1][e])return!1}return!0}win(){for(let t=0;t<this.row;t++){for(let e=0;e<this.col;e++)if(2048===this.blocks[t][e])return!0;return!1}}addBlock(){if(this.over())return!1;const t=k(0,3),e=k(0,3);this.blocks[t][e]?this.addBlock():this.blocks[t][e]=2}render(){this.renderRadius()}renderRadius(){for(let t=0;t<this.blocks.length;t++)for(let e=0;e<this.blocks[t].length;e++){const s=this.blocks[t][e];s&&(d.fillStyle=a[s],w(i*(e+1)+h*e,i*(t+1)+h*t,h,h,10),this.renderText(t,e,s))}}renderText(t,e,s){d.fillStyle="white",this.fontSize=u[(""+s).length].size;const r=i*(e+1)+h*e+h/2,o=i*(t+1)+h*t+h/2+u[(""+s).length].space;d.font=`${this.fontSize}px Microsoft YaHei`,d.fillText(s+"",r,o),d.textAlign="center"}}e.default=new class{constructor(t=60){this.fps=t,this.stop=!1,this.bg=new O,this.blocks=new x,this.msg=1,this.bindEvent()}run(){this.update(),this.clear(),this.draw(),setTimeout(()=>{this.run()},1e3/this.fps)}update(){}clear(){d.clearRect(0,0,f.width,f.height)}draw(){this.bg.render(),this.blocks.render(),this.renderMsg()}renderMsg(){const t={1:"Game Over",2:"You Win"};d.font="60px Microsoft YaHei",this.stop&&(d.fillStyle="rgba(0,0,0,.5)",w(0,0,l,l,10),d.fillStyle=1===this.msg?"red":"white",d.fillText(t[this.msg],l/2,l/2),d.textAlign="center")}start(){this.blocks.init(),this.stop=!1,this.msg=1}keyDown(t){const e=t.keyCode;if(49!==e){if(!this.stop)return this.blocks.gameOver()?(this.stop=!0,this.msg=1,!1):this.blocks.win()?(this.stop=!0,this.msg=2,!1):void this.blocks.move(e)}else this.start()}bindEvent(){g.on("swipeleft",()=>this.blocks.move(c.LEFT)),g.on("swiperight",()=>this.blocks.move(c.RIGHT)),g.on("swipeup",()=>this.blocks.move(c.UP)),g.on("swipedown",()=>this.blocks.move(c.DOWN)),p.addEventListener("click",this.start.bind(this))}}}]);